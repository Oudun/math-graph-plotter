<html>
 <head>
  <meta http-equiv="content-type" content="text/html; charset=UTF8">
    <style>
        .formulaType {
            font-family: Arial; 
//            font-style:italic;
            font-size:18pt;
            font-weight:bold;
        }
    </style>
    <script>


    </script>
 </head>
<body>
<span align="left">
    <button class="formulaType" onClick="javascript:to2D();toRect2();">y(x)</button>
    <button class="formulaType" onClick="javascript:to2D();toParam2();">x(t), y(t</button>
    <button class="formulaType" onClick="javascript:to3D();toParam3();">x(t), y(t), z(t)</button>
    <button class="formulaType" onClick="javascript:to2D();toPolar();">ρ(φ)</button>
    <button class="formulaType" onClick="javascript:to3D();toRect3();">z(x,y)</button>
    <button class="formulaType" onClick="javascript:to3D();toSpheric();">ρ(θ,φ)</button>
    <button class="formulaType" onClick="javascript:to3D();toCylindric();">ρ(φ,h)</button>
</span>
<br>
<canvas id="c" style="padding-top:5" width="580" height="480" onclick="javascript:selectFunction(event);">canvas not supported</canvas>
<canvas id="a" style="padding-top:5" width="580" height="480">canvas not supported</canvas>
<script src="functions.js"></script>
<script>

var c = document.getElementById("c");
var ctx = c.getContext("2d");
ctx.strokeRect(0, 0, c.width, c.height);
ctx.font = fullSizeFont;

canvas = document.getElementById("a");
context = canvas.getContext("2d");


    var  startX = -2;
    var  endX = 2;

    var  startY = -2;
    var  endY = 2;

    var  startZ = -2;
    var  endZ = 2;

    var gran = 16;
    var granPhi = 32;
    var granTheta = 16;

    var stepX = (endX-startX)/gran;
    var stepY = (endY-startY)/gran;

    var startTheta = -Math.PI/2;
    var endTheta = Math.PI/2;

    var startPhi = 0;
    var endPhi = 2*Math.PI;

    var stepTheta = (endTheta-startTheta)/granTheta;
    var stepPhi = (endPhi-startPhi)/granPhi;


</script>

<script src="graph2d.js"></script>
<script src="graph3d.js"></script>

<script>

var rootFunc;

function selectFunction(event) {

    selectedId = 0;
    var i = 0;
    for (i = 0; i < functions.length; i++) {
        if (functions[i]!=null&&
                typeof(functions[i]) !== 'undefined' &&
                (event.pageX - c.offsetLeft > functions[i].offsetX) &&
                (event.pageX - c.offsetLeft) < functions[i].offsetX + functions[i].width() &&
                (event.pageY - c.offsetTop) > functions[i].offsetY &&
                (event.pageY - c.offsetTop) < functions[i].offsetY + functions[i].height()
                ) {
            selectedId = functions[i].id;
        }
    }
    if (selectedId>0) {
        ctx.clearRect(0, 0, c.width, c.height);
        plot();
        ctx.strokeRect(
                functions[selectedId].offsetX,
                functions[selectedId].offsetY,
                functions[selectedId].width(),
                functions[selectedId].height());
    }
}

function setMultiply() {
    var child = new MUL();
    child.argFirst = new CONST("?");
    child.argSecond = new CONST("?");
    rootFunc.replaceChild(selectedId, child);
    ctx.clearRect(0, 0, c.width, c.height);
    plot();
}

function setAdd() {
    var child = new ADD();
    child.argFirst = new CONST("?");
    child.argSecond = new CONST("?");
    rootFunc.replaceChild(selectedId, child);
    ctx.clearRect(0, 0, c.width, c.height);
    plot();
}

function setDivide() {
    var child = new DIV();
    child.argFirst = new CONST("?");
    child.argSecond = new CONST("?");
    rootFunc.replaceChild(selectedId, child);
    ctx.clearRect(0, 0, c.width, c.height);
    plot();
}

function setConst(i) {
    var child = new CONST(i);
    rootFunc.replaceChild(selectedId, child);
    ctx.clearRect(0, 0, c.width, c.height);
    plot();
}

function setVarX(ch) {
    var child = new VARX(ch);
    rootFunc.replaceChild(selectedId, child);
    ctx.clearRect(0, 0, c.width, c.height);
    plot();
}

function setVarY(ch) {
    var child = new VARY(ch);
    rootFunc.replaceChild(selectedId, child);
    ctx.clearRect(0, 0, c.width, c.height);
    plot();
}

function setBrackets() {
    var child = new BRACKETS();
    child.arg = new CONST("?");
    rootFunc.replaceChild(selectedId, child);
    ctx.clearRect(0, 0, c.width, c.height);
    plot();
}

function setSquare() {
    var child = new SQUARE();
    child.arg = new CONST("?");
    rootFunc.replaceChild(selectedId, child);
    ctx.clearRect(0, 0, c.width, c.height);
    plot();
}

function setSinus() {
    var child = new SIN();
    child.arg = new CONST("?");
    rootFunc.replaceChild(selectedId, child);
    ctx.clearRect(0, 0, c.width, c.height);
    plot();
}


function plot() {
    ctx.strokeRect(0, 0, c.width, c.height);
    rootFunc.plot(32, 32, ctx);
}

function check() {
    var str = "";
    for (i in functions) {
        str += i;
        if (functions[i]!=null) {
            str += " id:" + functions[i].id;
            str += " x:" + functions[i].offsetX;
            str += " y:" + functions[i].offsetY;
            str += " w:" + functions[i].width();
            str += " h:" + functions[i].height();
        }
        str +="\n";
    }
    alert(str);
}

function checkMatrix(a) {
    alert (a);
}

</script>

<script>

    function clearGraph() {
        context.clearRect(0, 0, canvas.width, canvas.height);
    }

    function multiplyMatrixes(a, b) {
        return multiplyMatrixes(a, b);
    }

    function restore(a, b) {
        matrix = identityMatrix;
        graph();
    }

    function zoomIn(a, b) {
        matrix = multiplyMatrixes(matrix,ZoomInMatrix);
        graph();
    }

    function zoomOut(a, b) {
        matrix = multiplyMatrixes(matrix,ZoomOutMatrix);
        graph();
    }

    function to2D() {
        identityMatrix = IdentityMatrix2D;
        multiplyMatrixes=multiplyMatrixes2D;
        matrix = matrix2D;
        ZoomInMatrix = ZoomInMatrix2D;
        ZoomOutMatrix = ZoomOutMatrix2D;
        document.all["rotx"].style.display='none';
        document.all["roty"].style.display='none';
        document.all["rotz"].style.display='none';
    }

    function to3D() {
        identityMatrix = identityMatrix3D;
        multiplyMatrixes = multiplyMatrixes3D;
        matrix = matrix3D;
        ZoomInMatrix = ZoomInMatrix3D;
        ZoomOutMatrix = ZoomOutMatrix3D;
        document.all["rotx"].style.display='inline';
        document.all["roty"].style.display='inline';
        document.all["rotz"].style.display='inline';
    }

    function toRect2() {
        graph = graph2D;
        document.all["x"].style.display='inline';
        document.all["y"].style.display='none';
        document.all["theta"].style.display='none';
        document.all["phi"].style.display='none';
        document.all["t"].style.display='none';
        document.all["h"].style.display='none';
        rootFunc =  new ROOT_FUNCTION();
        rootFunc.arg = new SIN();
        rootFunc.arg.arg = new VARX("x");
        ctx.clearRect(0, 0, c.width, c.height);
        plot();
    }

    function toRect3() {
        graph = graphRect3D;
        document.all["x"].style.display='inline';
        document.all["y"].style.display='inline';
        document.all["theta"].style.display='none';
        document.all["phi"].style.display='none';
        document.all["t"].style.display='none';
        document.all["h"].style.display='none';
        rootFunc =  new ROOT_FUNCTION_RECT3D();
        rootFunc.arg = new ADD();
        rootFunc.arg.argFirst = new SQUARE();
        rootFunc.arg.argSecond = new SQUARE();
        rootFunc.arg.argFirst.arg = new VARX("x");
        rootFunc.arg.argSecond.arg = new VARY("y");
        ctx.clearRect(0, 0, c.width, c.height);
        plot();        
    }

    function toPolar() {
        graph = graph2D;//todo - replace
        document.all["x"].style.display='none';
        document.all["y"].style.display='none';
        document.all["theta"].style.display='none';
        document.all["phi"].style.display='inline';
        document.all["t"].style.display='none';
        document.all["h"].style.display='none';
    }

    function toParam2() {
        graph = graph2D;//todo - replace
        document.all["x"].style.display='none';
        document.all["y"].style.display='none';
        document.all["theta"].style.display='none';
        document.all["phi"].style.display='none';
        document.all["t"].style.display='inline';
        document.all["h"].style.display='none';
    }

    function toParam3() {
        graph = graphSpheric;//replace
        document.all["x"].style.display='none';
        document.all["y"].style.display='none';
        document.all["theta"].style.display='none';
        document.all["phi"].style.display='none';
        document.all["t"].style.display='inline';
        document.all["h"].style.display='none';
    }

    function toSpheric() {
        graph = graphSpheric;
        document.all["x"].style.display='none';
        document.all["y"].style.display='none';
        document.all["theta"].style.display='inline';
        document.all["phi"].style.display='inline';
        document.all["t"].style.display='none';
        document.all["h"].style.display='none';
        rootFunc =  new ROOT_FUNCTION_SPHERIC();
        rootFunc.arg = new SIN();
        rootFunc.arg.arg = new VARX("θ");
        ctx.clearRect(0, 0, c.width, c.height);
        plot();

    }

    function toCylindric() {
        graph = graphSpheric;//replace
        document.all["x"].style.display='none';
        document.all["y"].style.display='none';
        document.all["theta"].style.display='none';
        document.all["phi"].style.display='inline';
        document.all["t"].style.display='none';
        document.all["h"].style.display='inline';
    }

</script>

<br>

<div align="left">

    <button onClick="javascript:setMultiply();"><h2>?×?</h2></button>
    <button onClick="javascript:setDivide();"><h2>?/?</h2></button>
    <button onClick="javascript:setAdd();"><h2>?+?</h2></button>
    <button id="x"      onClick="javascript:setVarX('x');"><h2>x</h2></button>
    <button id="y"      onClick="javascript:setVarY('y');"><h2>y</h2></button>
    <button id="theta"  onClick="javascript:setVarX('θ');"><h2>θ</h2></button>
    <button id="phi"    onClick="javascript:setVarY('φ');"><h2>φ</h2></button>
    <button id="t"      onClick="javascript:setVarX('t');"><h2>t</h2></button>
    <button id="h"      onClick="javascript:setVarY('h');"><h2>h</h2></button>
    <button onClick="javascript:setConst(-1);"><h2>-1</h2></button>
    <button onClick="javascript:setConst(1);"><h2>1</h2></button>
    <button onClick="javascript:setConst(2);"><h2>2</h2></button>
    <button onClick="javascript:setBrackets();"><h2>(?)</h2></button>
    <button onClick="javascript:setSquare();"><h2>(?²)</h2></button>
    <button onClick="javascript:setSinus();"><h2>sin(?)</h2></button>

    <button style="background-color:red;color:white" onClick="javascript:check();"><h2>Check</h2></button>

    <button onClick="javascript:graph();"><h2>Graph</h2></button>
    <button onClick="javascript:clearGraph();"><h2>Clear</h2></button>
    <button onClick="javascript:zoomIn();"><h2>Zoom In</h2></button>
    <button onClick="javascript:zoomOut();"><h2>Zoom Out</h2></button>

    <button id="rotx" onClick="javascript:matrix=multiplyMatrixes(matrix,matrixRotX);graph();"><h2>X Rotation</h2></button>
    <button id="roty" onClick="javascript:matrix=multiplyMatrixes(matrix,matrixRotY);graph();"><h2>Y Rotation</h2></button>
    <button id="rotz" onClick="javascript:matrix=multiplyMatrixes(matrix,matrixRotZ);graph();"><h2>Z Rotation</h2></button>


    <button onClick="javascript:restore();"><h2>Restore</h2></button>

</div>

<script>
    to2D();
    toRect2();
</script>

</body>
</html>



