<html>
 <head>
  <meta http-equiv="content-type" content="text/html; charset=UTF8">
 </head>
<body>
<!--
<div align="left">
    <button><h1>y(x)</h1></button>
    <button><h1>x(t), y(t)</h1></button>
    <button><h1>x(t), y(t), z(t)</h1></button>
    <button><h1>ρ(φ)</h1></button>
    <button><h1>z(x,y)</h1></button>
    <button><h1>ρ(θ,φ)</h1></button>
    <button><h1>ρ(φ,h)</h1></button>
</div>
-->
<canvas id="c" width="580" height="480" onclick="javascript:selectFunction(event);">canvas not supported</canvas>
<canvas id="a" width="580" height="480">canvas not supported</canvas>
<script src="functions.js"></script>
<script>

var c = document.getElementById("c");
var ctx = c.getContext("2d");
ctx.strokeRect(0, 0, c.width, c.height);
ctx.font = fullSizeFont;

canvas = document.getElementById("a");
context = canvas.getContext("2d");

</script>

<script src="graph2d.js"></script>
<script src="graph3d.js"></script>


<script>
var rootFunc;

// div = Object.create(DIV);
// div.argFirst = Object.create(MUL);
// div.argFirst.argFirst = new VAR();
// div.argFirst.argSecond = new ADD();
// div.argFirst.argSecond.argFirst = new CONST(3);
// div.argFirst.argSecond.argSecond = Object.create(DIV);
// div.argFirst.argSecond.argSecond.argFirst = new CONST(4);
// div.argFirst.argSecond.argSecond.argSecond = new VAR();
// div.argSecond = new CONST(5);

rootFunc =  new ROOT_FUNCTION_SPHERIC();
rootFunc.arg = new SIN();
rootFunc.arg.arg = new VARX("x");

plot();

function selectFunction(event) {
    //alert((event.pageX-c.offsetLeft)+" "+(event.pageY-c.offsetTop);
    alert(event.pageY-c.offsetTop);
    selectedId = 0;
    var i = 0;
    for (i = 0; i < functions.length; i++) {
        if (functions[i]!=null&&
                typeof(functions[i]) !== 'undefined' &&
                (event.pageX - c.offsetLeft > functions[i].offsetX) &&
                (event.pageX - c.offsetLeft) < functions[i].offsetX + functions[i].width() &&
                (event.pageY - c.offsetTop) > functions[i].offsetY &&
                (event.pageY - c.offsetLeft) < functions[i].offsetY + functions[i].height()
                ) {
            selectedId = functions[i].id;
        }
    }
    if (selectedId>0) {
        ctx.clearRect(0, 0, c.width, c.height);
        plot();
        ctx.strokeRect(
                functions[selectedId].offsetX,
                functions[selectedId].offsetY,
                functions[selectedId].width(),
                functions[selectedId].height());
    }
}

function setMultiply() {
    var child = new MUL();
    child.argFirst = new CONST("?");
    child.argSecond = new CONST("?");
    rootFunc.replaceChild(selectedId, child);
    ctx.clearRect(0, 0, c.width, c.height);
    plot();
}

function setAdd() {
    var child = new ADD();
    child.argFirst = new CONST("?");
    child.argSecond = new CONST("?");
    rootFunc.replaceChild(selectedId, child);
    ctx.clearRect(0, 0, c.width, c.height);
    plot();
}

function setDivide() {
    var child = new DIV();
    child.argFirst = new CONST("?");
    child.argSecond = new CONST("?");
    rootFunc.replaceChild(selectedId, child);
    ctx.clearRect(0, 0, c.width, c.height);
    plot();
}

function setConst(i) {
    var child = new CONST(i);
    rootFunc.replaceChild(selectedId, child);
    ctx.clearRect(0, 0, c.width, c.height);
    plot();
}

function setVarX(ch) {
    var child = new VARX(ch);
    rootFunc.replaceChild(selectedId, child);
    ctx.clearRect(0, 0, c.width, c.height);
    plot();
}

function setVarY(ch) {
    var child = new VARY(ch);
    rootFunc.replaceChild(selectedId, child);
    ctx.clearRect(0, 0, c.width, c.height);
    plot();
}

function setBrackets() {
    var child = new BRACKETS();
    child.arg = new CONST("?");
    rootFunc.replaceChild(selectedId, child);
    ctx.clearRect(0, 0, c.width, c.height);
    plot();
}

function setSquare() {
    var child = new SQUARE();
    child.arg = new CONST("?");
    rootFunc.replaceChild(selectedId, child);
    ctx.clearRect(0, 0, c.width, c.height);
    plot();
}

function setSinus() {
    var child = new SIN();
    child.arg = new CONST("?");
    rootFunc.replaceChild(selectedId, child);
    ctx.clearRect(0, 0, c.width, c.height);
    plot();
}


function plot() {
    ctx.strokeRect(0, 0, c.width, c.height);
    rootFunc.plot(32, 32, ctx);
}

function check() {
    var str = "";
    for (i in functions) {
        if (functions[i]!=null) {
            str += functions[i].id + "   ";
        }
    }
    alert(str);
}

</script>

<script>

    function clearGraph() {
        //context.clearRect(canvas.offsetLeft, canvas.offsetTop, canvas.width, canvas.height);
        context.clearRect(0, 0, canvas.width, canvas.height);
    }

    function graph() {
        //graph2D();
        graph3D();
    }

    function multiplyMatrixes(a, b) {
//        return multiplyMatrixes2D(a, b);
        return multiplyMatrixes3D(a, b);
    }

    function restore(a, b) {
        //matrix2D = identityMatrix2D;
        matrix3D = identityMatrix3D;
        graph();
    }

    function zoomIn(a, b) {
        matrix3D = multiplyMatrixes(matrix3D,ZoomInMatrix3D);
        graph();
    }

    function zoomOut(a, b) {
        matrix3D = multiplyMatrixes(matrix3D,ZoomOutMatrix3D);
        graph();
    }


</script>


<br>


<div align="left">

    <button onClick="javascript:setMultiply();"><h2>?×?</h2></button>
    <button onClick="javascript:setDivide();"><h2>?/?</h2></button>
    <button onClick="javascript:setAdd();"><h2>?+?</h2></button>
    <button onClick="javascript:setVarX('x');"><h2>x</h2></button>
    <button onClick="javascript:setVarX('θ');"><h2>θ</h2></button>
    <button onClick="javascript:setVarY('y');"><h2>y</h2></button>
    <button onClick="javascript:setVarY('φ');"><h2>φ</h2></button>
    <button onClick="javascript:setConst(-1);"><h2>-1</h2></button>
    <button onClick="javascript:setConst(1);"><h2>1</h2></button>
    <button onClick="javascript:setConst(2);"><h2>2</h2></button>
    <button onClick="javascript:setBrackets();"><h2>(?)</h2></button>
    <button onClick="javascript:setSquare();"><h2>(?²)</h2></button>
    <button onClick="javascript:setSinus();"><h2>sin(?)</h2></button>

    <button style="background-color:red;color:white" onClick="javascript:checkLayout();"><h2>Check</h2></button>

    <button onClick="javascript:graph();"><h2>Graph</h2></button>
    <button onClick="javascript:clearGraph();"><h2>Clear</h2></button>
    <button onClick="javascript:zoomIn();"><h2>Zoom In</h2></button>
    <button onClick="javascript:zoomOut();"><h2>Zoom Out</h2></button>

    <button onClick="javascript:matrix3D = multiplyMatrixes(matrix3D,matrixRotX);graph();"><h2>X</h2></button>
    <button onClick="javascript:matrix3D = multiplyMatrixes(matrix3D,matrixRotY);graph();"><h2>Y</h2></button>
    <button onClick="javascript:matrix3D = multiplyMatrixes(matrix3D,matrixRotZ);graph();"><h2>Z</h2></button>


    <button onClick="javascript:restore();"><h2>Restore</h2></button>

</div>
<span id="check"></span>
</body>
</html>